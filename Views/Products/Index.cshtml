@model MonitoringConfigurator.Models.ProductCatalogViewModel
@using MonitoringConfigurator.Models
@{
    ViewData["Title"] = "Katalog produktów";
}

<div class="d-flex align-items-center justify-content-between mb-4 flex-wrap gap-3">
    <div>
        <h1 class="h2 text-white fw-bold mb-1">Katalog produktów</h1>
        <p class="text-muted mb-0">Znajdź najlepszy sprzęt do Twojej instalacji CCTV.</p>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterCanvas">
            <i class="bi bi-sliders"></i> Filtry i Sortowanie
        </button>

        @if (User.IsInRole("Admin"))
        {
            <a class="btn btn-outline-danger" asp-action="Manage">
                <i class="bi bi-gear-fill"></i> Zarządzaj
            </a>
        }
    </div>
</div>

<div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="filterCanvas" aria-labelledby="filterLabel" style="border-right: 1px solid #333;">
    <div class="offcanvas-header border-bottom border-secondary">
        <h5 class="offcanvas-title" id="filterLabel"><i class="bi bi-funnel"></i> Filtrowanie</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <form method="get" asp-action="Index">
            <div class="mb-4">
                <label asp-for="Query" class="form-label text-muted small text-uppercase fw-bold">Szukaj</label>
                <input asp-for="Query" class="form-control form-control-dark" placeholder="Nazwa, model..." />
            </div>

            <div class="mb-4">
                <label asp-for="Category" class="form-label text-muted small text-uppercase fw-bold">Kategoria</label>
                <select asp-for="Category" class="form-select form-select-dark" asp-items="Html.GetEnumSelectList<ProductCategory>()">
                    <option value="">Wszystkie</option>
                </select>
            </div>

            <hr class="border-secondary my-4" />

            <div class="mb-4">
                <label class="form-label text-muted small text-uppercase fw-bold">Cena (PLN)</label>
                <div class="input-group mb-2">
                    <input asp-for="MinPrice" class="form-control form-control-dark" placeholder="Od" type="number" />
                    <span class="input-group-text bg-dark border-secondary text-muted">-</span>
                    <input asp-for="MaxPrice" class="form-control form-control-dark" placeholder="Do" type="number" />
                </div>
            </div>

            <div class="mb-4">
                <label asp-for="MinResolution" class="form-label text-muted small text-uppercase fw-bold">Min. Rozdzielczość</label>
                <select asp-for="MinResolution" class="form-select form-select-dark">
                    <option value="">Dowolna</option>
                    <option value="2">2 Mpix (FullHD)</option>
                    <option value="4">4 Mpix (2K)</option>
                    <option value="5">5 Mpix</option>
                    <option value="8">8 Mpix (4K)</option>
                </select>
            </div>

            <div class="mb-4">
                <div class="form-check form-switch">
                    <input asp-for="OutdoorOnly" class="form-check-input" type="checkbox" role="switch" style="cursor:pointer;">
                    <label class="form-check-label text-white" asp-for="OutdoorOnly">Tylko zewnętrzne (Outdoor)</label>
                </div>
            </div>

            <hr class="border-secondary my-4" />

            <div class="mb-4">
                <label asp-for="SortBy" class="form-label text-muted small text-uppercase fw-bold">Sortowanie</label>
                <select asp-for="SortBy" class="form-select form-select-dark">
                    <option value="">Domyślne (Nazwa A-Z)</option>
                    <option value="name_desc">Nazwa Z-A</option>
                    <option value="price_asc">Cena: rosnąco</option>
                    <option value="price_desc">Cena: malejąco</option>
                </select>
            </div>

            <div class="d-grid gap-2 mt-5">
                <button type="submit" class="btn btn-primary btn-lg">Zastosuj filtry</button>
                <a asp-action="Index" class="btn btn-outline-secondary">Wyczyść wszystko</a>
            </div>
        </form>
    </div>
</div>

@if (!Model.Products.Any())
{
    <div class="text-center py-5">
        <div class="mb-3"><i class="bi bi-inbox text-muted opacity-25" style="font-size: 4rem;"></i></div>
        <h4 class="text-muted">Brak wyników.</h4>
        <p class="text-muted small">Spróbuj zmienić parametry filtrowania.</p>
        <a asp-action="Index" class="btn btn-outline-danger mt-2">Pokaż wszystko</a>
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 row-cols-xxl-4 g-4">
        @foreach (var item in Model.Products)
        {
            <div class="col">
                <div class="product-card">
                    <div class="product-img-container">
                        <span class="category-badge">@item.Category</span>
                        @if (!string.IsNullOrWhiteSpace(item.ImageUrl))
                        {
                            <img src="@item.ImageUrl" alt="@item.Name" />
                        }
                        else
                        {
                            <i class="bi bi-camera-video text-secondary opacity-25" style="font-size: 4rem;"></i>
                        }
                    </div>

                    <div class="product-body">
                        <a asp-action="Details" asp-route-id="@item.Id" class="product-title text-truncate" title="@item.Name">
                            @item.Name
                        </a>
                        <div class="product-model">@item.Brand @item.Model</div>

                        <div class="product-price">
                            @if (item.Price > 0)
                            {
                                @item.Price.ToString("N2") <small class="fs-6 fw-normal text-muted">zł</small>
                            }
                            else
                            {
                                <span class="text-muted fs-6">Wycena indyw.</span>
                            }
                        </div>

                        <div class="specs-grid">
                            @if (item.ResolutionMp.HasValue)
                            {
                                <div class="spec-item" title="Rozdzielczość"><i class="bi bi-eye"></i> @item.ResolutionMp Mpix</div>
                            }
                            @if (item.IrRangeM.HasValue)
                            {
                                <div class="spec-item" title="Zasięg IR"><i class="bi bi-moon-stars"></i> IR @item.IrRangeM m</div>
                            }
                            @if (item.Channels.HasValue)
                            {
                                <div class="spec-item" title="Kanały"><i class="bi bi-grid-3x3"></i> @item.Channels kan.</div>
                            }
                            @if (item.PoeBudgetW.HasValue)
                            {
                                <div class="spec-item" title="Budżet PoE"><i class="bi bi-lightning-charge"></i> @item.PoeBudgetW W</div>
                            }
                            @if (item.StorageTB.HasValue)
                            {
                                <div class="spec-item" title="Pojemność"><i class="bi bi-hdd"></i> @item.StorageTB TB</div>
                            }
                            @if (item.Outdoor == true)
                            {
                                <div class="spec-item" title="Zewnętrzna"><i class="bi bi-cloud-rain"></i> IP67</div>
                            }
                        </div>

                        <div class="d-grid mt-2">
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-outline-secondary btn-sm">Szczegóły</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}