@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@{
    ViewData["Title"] = "Mój profil";
    var user = await UserManager.GetUserAsync(User);
    var email = user != null ? await UserManager.GetEmailAsync(user) : "";
    var phone = user != null ? await UserManager.GetPhoneNumberAsync(user) : "";
    var twofa = user != null && await UserManager.GetTwoFactorEnabledAsync(user);
    string initials = (email ?? User.Identity?.Name ?? "Użytkownik").Trim();
    if (!string.IsNullOrWhiteSpace(initials)) {
        var parts = initials.Split('@')[0].Split('.','-','_');
        initials = string.Join("", parts.Where(p=>!string.IsNullOrEmpty(p)).Select(p=>p[0])).ToUpperInvariant();
        if (initials.Length > 3) initials = initials.Substring(0,3);
    } else { initials = "U"; }
}
<style>
  body{background:#0f0f10;color:#e5e7eb}
  .card{background:#151518;border:1px solid #2b2b2b;border-radius:12px}
  .muted{color:#9ca3af}
  .avatar{width:68px;height:68px;border-radius:50%;display:flex;align-items:center;justify-content:center;
          background:linear-gradient(135deg,#ff3b30,#ff6b61);font-weight:800;font-size:1.2rem;color:white}
  a.link{color:#ff3b30;text-decoration:none}
  a.link:hover{text-decoration:underline}
  .btn-danger{background:#ff3b30;border-color:#ff3b30}
  .chip{border:1px solid #2b2b2b;border-radius:999px;padding:.15rem .6rem}
  .kv{display:flex;justify-content:space-between;gap:12px;padding:.35rem 0;border-bottom:1px dashed #2b2b2b}
  .kv:last-child{border-bottom:none}
</style>

<div class="container py-4">
  <div class="d-flex align-items-center gap-3 mb-3">
    <div class="avatar">@initials</div>
    <div>
      <h1 class="mb-0">Mój profil</h1>
      <div class="muted">@email</div>
    </div>
    <div class="ms-auto d-flex gap-2">
      <a class="btn btn-danger" href="/Identity/Account/Manage">Zarządzaj kontem</a>
      <a class="btn btn-outline-light" href="/Identity/Account/Logout">Wyloguj</a>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-lg-6">
      <div class="card p-3 h-100">
        <h5>Podstawowe informacje</h5>
        <div class="kv"><span>E‑mail</span><span>@email</span></div>
        <div class="kv"><span>Telefon</span><span>@(string.IsNullOrWhiteSpace(phone) ? "—" : phone)</span></div>
        <div class="kv"><span>Dwuskładnikowe (2FA)</span><span>@(twofa ? "Włączone" : "Wyłączone")</span></div>
        <div class="mt-2 d-flex flex-wrap gap-2">
          <a class="chip link" href="/Identity/Account/Manage/Email">Zmień e‑mail</a>
          <a class="chip link" href="/Identity/Account/Manage/ChangePassword">Zmień hasło</a>
          <a class="chip link" href="/Identity/Account/Manage/TwoFactorAuthentication">2FA</a>
          <a class="chip link" href="/Identity/Account/Manage/PersonalData">Dane osobowe</a>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card p-3 h-100">
        <h5>Preferencje</h5>
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="fw-semibold">Motyw</div>
            <div class="muted">Zapamiętywany w przeglądarce</div>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="themeToggle">
            <label class="form-check-label" for="themeToggle">Ciemny</label>
          </div>
        </div>
        <hr/>
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <div class="fw-semibold">Powiadomienia e‑mail</div>
            <div class="muted">Status informacyjny (demo)</div>
          </div>
          <span class="chip">Włączone</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card p-3 mt-3">
    <h5>Szybkie skróty</h5>
    <div class="d-flex flex-wrap gap-2">
      <a class="btn btn-outline-light" href="/Identity/Account/Manage">Ustawienia konta</a>
      <a class="btn btn-outline-light" href="/Identity/Account/Manage/ChangePassword">Zmień hasło</a>
      <a class="btn btn-outline-light" href="/Identity/Account/Manage/TwoFactorAuthentication">Ustaw 2FA</a>
      <a class="btn btn-outline-light" href="/Identity/Account/Manage/PersonalData">Pobierz/usuwanie danych</a>
    </div>
  </div>

  <div class="alert alert-dark border mt-3">
    Szukasz pomocy? Przejdź do <a class="link" asp-controller="Info" asp-action="Support">Wsparcia</a> lub sprawdź <a class="link" asp-controller="Info" asp-action="Faq">FAQ</a>.
  </div>
</div>

@section Scripts{
<script>
  // Demo przełącznika motywu (localStorage)
  (function(){
    const key = 'mc_theme_dark';
    const input = document.getElementById('themeToggle');
    function apply(v){ document.documentElement.dataset.theme = v ? 'dark':'light'; }
    input.checked = localStorage.getItem(key) !== 'false';
    apply(input.checked);
    input.addEventListener('change', function(){ localStorage.setItem(key, this.checked); apply(this.checked); });
  })();
</script>
}
